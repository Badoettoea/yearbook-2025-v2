<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile - Yearbook 2025</title>
    <link rel="stylesheet" href="css/memories.css"> <!-- Sesuaikan kalau CSS beda -->
</head>
<body>
    <h1>User Profile</h1>
    <div class="profile-photo">
        <img id="profilePhoto" src="https://via.placeholder.com/150" alt="Profile Photo">
        <input type="file" accept="image/*"> <!-- Tanpa id -->
        <button onclick="document.querySelector('input[type=file]').click()">Change Photo</button>
        <button onclick="uploadPhoto()">Submit</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Inisialisasi Supabase
        const supabase = Supabase.createClient(
            'https://dswzjhefngrgzowcilll.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRzd3pqaGVmbmdyZ3pvd2NpbGxsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY4MTc3OTAsImV4cCI6MjA2MjM5Mzc5MH0.V6ZXOvPRKXtGZz13VG4tOH3RC8eGplsqUwWn_fkeeG0'
        );

        async function uploadPhoto() {
            const fileInput = document.querySelector('input[type=file]');
            const file = fileInput.files[0];
            if (!file) {
                alert('Pilih foto dulu, bro!');
                return;
            }

            // Upload ke bucket student-photos
            const userId = 'user123'; // Ganti dengan user ID dinamis (misalnya, dari auth)
            const filePath = `${userId}/${file.name}`; // Simpan di subfolder user
            const { data, error } = await supabase.storage
                .from('student-photos')
                .upload(filePath, file, { upsert: true });

            if (error) {
                console.error('Gagal mengunggah foto:', error.message);
                alert('Gagal upload: ' + error.message);
                return;
            }

            // Update foto di UI
            const { data: urlData } = supabase.storage
                .from('student-photos')
                .getPublicUrl(filePath);
            document.getElementById('profilePhoto').src = urlData.publicUrl;
            alert('Foto berhasil diupload, bro!');
        }
    </script>
</body>
</html>
